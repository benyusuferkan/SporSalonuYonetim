@{
    ViewData["Title"] = "AI Spor HocasÄ±";
}

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <div class="card shadow-lg border-0">
                
                <div class="card-header bg-primary text-white text-center py-4" 
                     style="background: linear-gradient(45deg, #0d6efd, #0dcaf0);">
                    <h2 class="mb-1">ðŸ¤– Yapay Zeka Spor KoÃ§u</h2>
                    <p class="mb-0 text-white-50">Gemini AI destekli kiÅŸisel programÄ±nÄ±z</p>
                </div>

                <div class="card-body p-4 p-md-5">
                    
                    <form id="aiForm">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label fw-bold">YaÅŸÄ±nÄ±z</label>
                                <input type="number" id="age" class="form-control" placeholder="Ã–rn: 22" min="10" max="100" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Kilonuz (kg)</label>
                                <input type="number" id="weight" class="form-control" placeholder="Ã–rn: 80" min="30" max="250" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Boyunuz (cm)</label>
                                <input type="number" id="height" class="form-control" placeholder="Ã–rn: 180" min="100" max="250" required>
                            </div>
                            <div class="col-12 mt-3">
                                <label class="form-label fw-bold">Hedefiniz Nedir?</label>
                                <select id="goal" class="form-select" required>
                                    <option value="" selected disabled>Bir hedef seÃ§in...</option>
                                    <option value="Kilo Vermek (YaÄŸ YakÄ±mÄ±)">Kilo Vermek (YaÄŸ YakÄ±mÄ±)</option>
                                    <option value="Kas KÃ¼tlesi Kazanmak (Hacim)">Kas KÃ¼tlesi Kazanmak (Hacim)</option>
                                    <option value="Fit Olmak ve SÄ±kÄ±laÅŸmak">Fit Olmak ve SÄ±kÄ±laÅŸmak</option>
                                    <option value="Kondisyon ArtÄ±rmak">Kondisyon ArtÄ±rmak</option>
                                </select>
                            </div>
                            
                            <div class="col-12 mt-4">
                                <button type="submit" id="btnGenerate" class="btn btn-primary w-100 py-3 fw-bold fs-5 shadow-sm">
                                    ðŸš€ ProgramÄ±mÄ± OluÅŸtur
                                </button>
                            </div>
                        </div>
                    </form>

                    <div id="loadingArea" class="text-center mt-5 d-none">
                        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted fs-5">VÃ¼cut analizin yapÄ±lÄ±yor ve programÄ±n hazÄ±rlanÄ±yor, lÃ¼tfen bekle...</p>
                    </div>

                    <div id="resultArea" class="mt-5 d-none">
                        <div class="alert alert-success border-0 shadow-sm">
                            <h4 class="alert-heading fw-bold mb-3">ðŸ“‹ Sana Ã–zel HazÄ±rlanan Program:</h4>
                            <hr>
                            <div id="aiResponseContent" class="mt-3" style="line-height: 1.8;"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#aiForm").submit(function (e) {
                e.preventDefault();

                // Form verilerini al
                var age = $("#age").val();
                var weight = $("#weight").val();
                var height = $("#height").val();
                var goal = $("#goal").val();

                // UI gÃ¼ncellemesi: YÃ¼kleniyor gÃ¶ster, formu kilitle
                $("#loadingArea").removeClass("d-none");
                $("#resultArea").addClass("d-none");
                $("#btnGenerate").prop("disabled", true).html('<i class="fa fa-spinner fa-spin"></i> HazÄ±rlanÄ±yor...');

                $.ajax({
                    url: '@Url.Action("GetPlan", "Ai")', 
                    type: 'POST',
                    data: { age: age, weight: weight, height: height, goal: goal },
                    success: function (response) {
                        // UI gÃ¼ncellemesi: YÃ¼kleniyor gizle, butonu aÃ§
                        $("#loadingArea").addClass("d-none");
                        $("#btnGenerate").prop("disabled", false).html('ðŸš€ ProgramÄ±mÄ± OluÅŸtur');

                        if (response.success) {
                            // Markdown'Ä± HTML'e Ã§evir ve ekrana bas
                            var htmlContent = marked.parse(response.message);
                            $("#aiResponseContent").html(htmlContent);
                            $("#resultArea").removeClass("d-none");
                            
                            // SayfayÄ± sonucun olduÄŸu yere kaydÄ±r
                            $('html, body').animate({
                                scrollTop: $("#resultArea").offset().top - 100
                            }, 500);

                        } else {
                            alert("UyarÄ±: " + response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        $("#loadingArea").addClass("d-none");
                        $("#btnGenerate").prop("disabled", false).html('ðŸš€ ProgramÄ±mÄ± OluÅŸtur');
                        alert("Bir hata oluÅŸtu. LÃ¼tfen daha sonra tekrar deneyin.\nHata: " + error);
                    }
                });
            });
        });
    </script>
}